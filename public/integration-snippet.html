<!DOCTYPE html>
<!--
================================================================================
YOUNZEE VIRTUAL TRY-ON - SNIPPET D'INT√âGRATION
================================================================================

Ce fichier contient le code pr√™t √† copier-coller pour int√©grer Younzee
sur votre site e-commerce (non-Shopify).

Instructions:
1. Copiez le code CSS dans votre <head> ou fichier CSS
2. Copiez le bouton HTML l√† o√π vous voulez qu'il apparaisse (page produit)
3. Copiez le code JavaScript avant </body>
4. Remplacez 'https://votre-domaine-younzee.netlify.app' par votre URL

================================================================================
-->

<!-- ========== 1. CSS √Ä COPIER DANS VOTRE <HEAD> ========== -->
<style>
  /* Bouton "Essayer virtuellement" */
  .younzee-cta-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    max-width: 400px;
    padding: 16px 24px;
    margin: 16px 0;
    background: #000000;
    color: #ffffff;
    border: 2px solid #000000;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .younzee-cta-button:hover {
    background: #333333;
    border-color: #333333;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .younzee-cta-button svg {
    width: 20px;
    height: 20px;
  }

  /* Container iframe */
  .younzee-iframe-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 99999;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .younzee-iframe-container.active {
    pointer-events: auto;
    opacity: 1;
  }

  .younzee-iframe-container iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Badge optionnel */
  .younzee-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: #666;
    margin-top: 8px;
  }

  .younzee-badge strong {
    color: #000;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .younzee-cta-button {
      font-size: 15px;
      padding: 14px 20px;
    }
  }
</style>

<!-- ========== 2. BOUTON √Ä COPIER SUR VOTRE PAGE PRODUIT ========== -->
<div class="younzee-cta-wrapper">
  <button
    id="younzee-open-button"
    class="younzee-cta-button"
    type="button"
    aria-label="Essayer virtuellement avec Younzee"
  >
    <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
    </svg>
    Essayer virtuellement
  </button>

  <div class="younzee-badge">
    powered by <strong>Younzee</strong>
  </div>
</div>

<!-- Container de l'iframe (sera affich√© au clic sur le bouton) -->
<div id="younzee-iframe-container" class="younzee-iframe-container">
  <iframe
    id="younzee-iframe"
    src=""
    allow="camera"
    title="Younzee Virtual Try-On"
    loading="lazy"
  ></iframe>
</div>

<!-- ========== 3. JAVASCRIPT √Ä COPIER AVANT </BODY> ========== -->
<script>
(function() {
  'use strict';

  // ‚öôÔ∏è CONFIGURATION - MODIFIEZ CES VALEURS
  const YOUNZEE_IFRAME_URL = 'https://votre-domaine-younzee.netlify.app'; // ‚ö†Ô∏è MODIFIER ICI
  const YOUNZEE_IFRAME_ORIGIN = YOUNZEE_IFRAME_URL;

  // √âl√©ments DOM
  const iframeContainer = document.getElementById('younzee-iframe-container');
  const iframe = document.getElementById('younzee-iframe');
  const openButton = document.getElementById('younzee-open-button');

  // ========== FONCTION √Ä ADAPTER: R√©cup√©rer les donn√©es du produit ==========
  function getCurrentProductData() {
    // üîß ADAPTEZ CETTE FONCTION SELON VOTRE SITE E-COMMERCE

    // Exemple 1: R√©cup√©ration via data attributes
    const productElement = document.querySelector('[data-product-id]');
    if (productElement) {
      return {
        id: productElement.dataset.productId,
        name: productElement.dataset.productName || document.title,
        imageUrl: productElement.dataset.productImage ||
                  document.querySelector('meta[property="og:image"]')?.content,
        category: productElement.dataset.category,
        price: productElement.dataset.price,
      };
    }

    // Exemple 2: R√©cup√©ration via meta tags OpenGraph
    const ogImage = document.querySelector('meta[property="og:image"]')?.content;
    const ogTitle = document.querySelector('meta[property="og:title"]')?.content;

    if (ogImage && ogTitle) {
      return {
        id: window.location.pathname,
        name: ogTitle,
        imageUrl: ogImage,
      };
    }

    // Exemple 3: R√©cup√©ration via JSON-LD
    const jsonLdScript = document.querySelector('script[type="application/ld+json"]');
    if (jsonLdScript) {
      try {
        const productData = JSON.parse(jsonLdScript.textContent);
        if (productData['@type'] === 'Product') {
          return {
            id: productData.sku || productData.productID,
            name: productData.name,
            imageUrl: productData.image,
            price: productData.offers?.price,
          };
        }
      } catch (e) {
        console.error('Erreur parsing JSON-LD:', e);
      }
    }

    // Fallback: donn√©es minimales
    console.warn('‚ö†Ô∏è Impossible de d√©tecter automatiquement le produit. Veuillez adapter getCurrentProductData().');
    return {
      id: window.location.pathname,
      name: document.title,
      imageUrl: document.querySelector('img.product-image')?.src,
    };
  }

  // ========== FONCTION √Ä ADAPTER: Ajouter au panier ==========
  function addToCart(productId, size, fitType) {
    // üîß ADAPTEZ CETTE FONCTION SELON VOTRE SYST√àME DE PANIER

    console.log('üõí Ajout au panier demand√©:', { productId, size, fitType });

    // Exemple 1: API custom
    /*
    fetch('/api/cart/add', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        productId: productId,
        quantity: 1,
        size: size,
        fitType: fitType,
        source: 'younzee-vto'
      })
    })
    .then(response => response.json())
    .then(data => {
      alert('‚úÖ Produit ajout√© au panier avec la taille ' + size);
      closeYounzee();
      // Rediriger vers le panier ou ouvrir un cart drawer
      // window.location.href = '/cart';
    })
    .catch(error => {
      console.error('‚ùå Erreur ajout panier:', error);
      alert('Une erreur est survenue.');
    });
    */

    // Exemple 2: Formulaire HTML
    /*
    const form = document.getElementById('add-to-cart-form');
    const sizeSelect = form.querySelector('[name="size"]');
    if (sizeSelect) {
      sizeSelect.value = size;
    }
    form.submit();
    */

    // Exemple 3: D√©mo simple
    alert(`‚úÖ Produit ajout√© au panier\n\nTaille: ${size}\nCoupe: ${fitType}\n\n(Veuillez adapter la fonction addToCart() dans le code)`);
    closeYounzee();
  }

  // Ouvrir l'iframe
  function openYounzee() {
    // Charger l'iframe si pas encore fait
    if (!iframe.src) {
      iframe.src = YOUNZEE_IFRAME_URL;
    }

    iframeContainer.classList.add('active');
    document.body.style.overflow = 'hidden';

    // Attendre que l'iframe soit charg√©e puis envoyer le message
    iframe.addEventListener('load', function() {
      iframe.contentWindow.postMessage({
        type: 'OPEN_YOUNZEE'
      }, YOUNZEE_IFRAME_ORIGIN);
    }, { once: true });

    // Si d√©j√† charg√©e, envoyer directement
    if (iframe.contentDocument?.readyState === 'complete') {
      iframe.contentWindow.postMessage({
        type: 'OPEN_YOUNZEE'
      }, YOUNZEE_IFRAME_ORIGIN);
    }
  }

  // Fermer l'iframe
  function closeYounzee() {
    iframeContainer.classList.remove('active');
    document.body.style.overflow = '';
  }

  // √âcouter les clics sur le bouton
  if (openButton) {
    openButton.addEventListener('click', function() {
      console.log('üéØ Ouverture de Younzee VTO');
      openYounzee();
    });
  }

  // √âcouter les messages de l'iframe
  window.addEventListener('message', function(event) {
    // V√©rifier l'origine (‚ö†Ô∏è IMPORTANT EN PRODUCTION)
    if (event.origin !== YOUNZEE_IFRAME_ORIGIN) {
      return;
    }

    console.log('üì© Message re√ßu de Younzee:', event.data.type);

    // L'iframe demande les informations du produit
    if (event.data.type === 'REQUEST_CLOTHING_ITEM') {
      const productData = getCurrentProductData();

      if (productData) {
        iframe.contentWindow.postMessage({
          type: 'CLOTHING_ITEM_DATA',
          item: productData
        }, YOUNZEE_IFRAME_ORIGIN);

        console.log('‚úÖ Donn√©es produit envoy√©es:', productData);
      } else {
        console.error('‚ùå Impossible de r√©cup√©rer les donn√©es du produit');
      }
    }

    // L'utilisateur veut ajouter au panier
    if (event.data.type === 'ADD_TO_CART') {
      const { size, fitType } = event.data;
      const productData = getCurrentProductData();

      if (productData) {
        addToCart(productData.id, size, fitType);
      }
    }

    // L'iframe a √©t√© ferm√©e
    if (event.data.type === 'YOUNZEE_CLOSED') {
      console.log('‚ùå Younzee ferm√© par l\'utilisateur');
      closeYounzee();
    }
  });

  // Pr√©charger l'iframe au survol (optionnel, am√©liore la performance)
  if (openButton) {
    openButton.addEventListener('mouseenter', function() {
      if (!iframe.src) {
        iframe.src = YOUNZEE_IFRAME_URL;
      }
    }, { once: true });
  }

  // Permettre de fermer avec la touche √âchap
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && iframeContainer.classList.contains('active')) {
      closeYounzee();
    }
  });

})();
</script>

<!-- ========== FIN DU CODE D'INT√âGRATION ========== -->
