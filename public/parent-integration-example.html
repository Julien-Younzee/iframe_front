<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemple d'int√©gration - Younzee</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .product-page {
            display: flex;
            gap: 40px;
            margin-bottom: 40px;
        }
        .product-image {
            flex: 1;
            background-color: #f0f0f0;
            padding: 20px;
            text-align: center;
        }
        .product-info {
            flex: 1;
        }
        .iframe-container {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-top: 40px;
        }
        iframe {
            width: 100%;
            height: 700px;
            border: none;
        }
    </style>
</head>
<body>
    <h1>Exemple de page produit avec Younzee</h1>

    <div class="product-page">
        <div class="product-image">
            <h2>Image du v√™tement</h2>
            <p>Veste en jean bleu</p>
            <p>R√©f√©rence: JACKET-001</p>
        </div>
        <div class="product-info">
            <h2>Veste en jean classique</h2>
            <p>Une veste en jean intemporelle parfaite pour toutes les saisons.</p>
            <p><strong>Prix: 79.99‚Ç¨</strong></p>
            <button>Ajouter au panier</button>
        </div>
    </div>

    <h2>Essayez virtuellement</h2>
    <div class="iframe-container">
        <!-- Int√©gration de l'iframe Younzee -->
        <iframe
            id="younzee-iframe"
            src="http://localhost:3000"
            allow="camera"
            title="Younzee Virtual Try-On"
        ></iframe>
    </div>

    <script>
        // Configuration
        const YOUNZEE_IFRAME_ORIGIN = 'http://localhost:3000'; // Remplacer par votre domaine en production

        // Exemple de donn√©es de v√™tement √† envoyer √† l'iframe
        const clothingItemData = {
            id: 'JACKET-001',
            name: 'Veste en jean classique',
            category: 'jacket',
            size: 'M',
            color: 'blue',
            // IMPORTANT: URL compl√®te de l'image du v√™tement (sera convertie en base64 par l'iframe)
            imageUrl: 'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800',
            // Vous pouvez aussi envoyer directement le base64 si vous l'avez d√©j√†
            // imageBase64: 'data:image/jpeg;base64,...',
        };

        // √âcouter les messages de l'iframe
        window.addEventListener('message', function(event) {
            // S√âCURIT√â: V√©rifier l'origine en production
            // if (event.origin !== YOUNZEE_IFRAME_ORIGIN) {
            //     console.warn('Message re√ßu d\'une origine non autoris√©e:', event.origin);
            //     return;
            // }

            console.log('üì© Message re√ßu de l\'iframe:', event.data);

            // L'iframe demande les informations du v√™tement
            if (event.data.type === 'REQUEST_CLOTHING_ITEM') {
                console.log('üîç L\'iframe demande les infos du v√™tement');
                const iframe = document.getElementById('younzee-iframe');

                // D√©tecter automatiquement le v√™tement ou utiliser les donn√©es pr√©d√©finies
                const itemData = detectClothingItem() || clothingItemData;

                iframe.contentWindow.postMessage({
                    type: 'CLOTHING_ITEM_DATA',
                    item: itemData
                }, '*');

                console.log('‚úÖ Donn√©es du v√™tement envoy√©es √† l\'iframe');
            }

            // L'utilisateur veut ajouter au panier depuis l'iframe
            if (event.data.type === 'ADD_TO_CART') {
                console.log('üõí Ajout au panier demand√©:', event.data);
                const { size, fitType } = event.data;

                // Impl√©menter votre logique d'ajout au panier ici
                addToCart(clothingItemData.id, size, fitType);
            }

            // L'iframe a √©t√© ferm√©e
            if (event.data.type === 'YOUNZEE_CLOSED') {
                console.log('‚ùå L\'iframe Younzee a √©t√© ferm√©e');
            }
        });

        // Fonction pour d√©tecter automatiquement le v√™tement de la page
        function detectClothingItem() {
            // Logique pour extraire les informations du v√™tement depuis la page
            // Cette fonction d√©pendra de la structure de votre site e-commerce

            // Exemple 1: extraction depuis des meta tags OpenGraph
            const itemName = document.querySelector('meta[property="og:title"]')?.content;
            const itemImage = document.querySelector('meta[property="og:image"]')?.content;

            // Exemple 2: extraction depuis des data attributes
            const productElement = document.querySelector('[data-product-id]');

            // Exemple 3: extraction depuis le JSON-LD (schema.org)
            const jsonLdScript = document.querySelector('script[type="application/ld+json"]');
            let productData = null;
            if (jsonLdScript) {
                try {
                    productData = JSON.parse(jsonLdScript.textContent);
                } catch (e) {
                    console.error('Erreur parsing JSON-LD:', e);
                }
            }

            // Retourner null si pas de donn√©es d√©tect√©es
            if (!itemImage && !productElement && !productData) {
                return null;
            }

            return {
                id: productElement?.dataset.productId || productData?.sku,
                name: itemName || productData?.name,
                imageUrl: itemImage || productData?.image,
                category: productElement?.dataset.category,
                // ... autres donn√©es
            };
        }

        // Fonction d'ajout au panier (√† adapter selon votre e-commerce)
        function addToCart(productId, size, fitType) {
            console.log(`üõí Ajout au panier: Produit ${productId}, Taille ${size}, Coupe ${fitType}`);

            // Exemple avec Shopify
            // fetch('/cart/add.js', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({
            //         id: productId,
            //         quantity: 1,
            //         properties: { 'Taille Younzee': size, 'Coupe': fitType }
            //     })
            // });

            // Exemple avec WooCommerce
            // jQuery.post('/wp-admin/admin-ajax.php', {
            //     action: 'woocommerce_add_to_cart',
            //     product_id: productId,
            //     variation: { size: size }
            // });

            alert(`‚úÖ Ajout√© au panier: Taille ${size} (${fitType})`);
        }

        // Fonction pour ouvrir/fermer l'iframe manuellement
        function toggleYounzee(open) {
            const iframe = document.getElementById('younzee-iframe');
            iframe.contentWindow.postMessage({
                type: open ? 'OPEN_YOUNZEE' : 'CLOSE_YOUNZEE'
            }, '*');
        }
    </script>
</body>
</html>
